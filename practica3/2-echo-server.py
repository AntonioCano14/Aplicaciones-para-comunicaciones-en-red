import socket
from random import randrange
import threading

def minas9x9():
    print ("                 ")
    print ("        1   2   3   4   5   6   7   8   9       ")
    print ("      +---+---+---+---+---+---+---+---+---+       ")
    print ("a     | %c | %c | %c | %c | %c | %c | %c | %c | %c |      " % (N[0], N[1], N[2],N[3], N[4], N[5],N[6], N[7], N[8]) )
    print ("      +---+---+---+---+---+---+---+---+---+       ")
    print ("b     | %c | %c | %c | %c | %c | %c | %c | %c | %c |      " % (N[9], N[10], N[11],N[12], N[13], N[14],N[15], N[16], N[17]) )
    print ("      +---+---+---+---+---+---+---+---+---+       ")
    print ("c     | %c | %c | %c | %c | %c | %c | %c | %c | %c |      " % (N[18], N[19], N[20],N[21], N[22], N[23],N[24], N[25], N[26]) )
    print ("      +---+---+---+---+---+---+---+---+---+       ")
    print ("d     | %c | %c | %c | %c | %c | %c | %c | %c | %c |      " % (N[27], N[28], N[29],N[30], N[31], N[32],N[33], N[34], N[35]) )
    print ("      +---+---+---+---+---+---+---+---+---+       ")
    print ("e     | %c | %c | %c | %c | %c | %c | %c | %c | %c |      " % (N[36], N[37], N[38],N[39], N[40], N[41],N[42], N[43], N[44]) )
    print ("      +---+---+---+---+---+---+---+---+---+       ")
    print ("f     | %c | %c | %c | %c | %c | %c | %c | %c | %c |      " % (N[45], N[46], N[47],N[48], N[49], N[50],N[51], N[52], N[53]) )
    print ("      +---+---+---+---+---+---+---+---+---+       ")
    print ("g     | %c | %c | %c | %c | %c | %c | %c | %c | %c |      " % (N[54], N[55], N[56],N[57], N[58], N[59],N[60], N[61], N[62]) )
    print ("      +---+---+---+---+---+---+---+---+---+       ")
    print ("h     | %c | %c | %c | %c | %c | %c | %c | %c | %c |      " % (N[63], N[64], N[65],N[66], N[67], N[68],N[69], N[70], N[71]) )
    print ("      +---+---+---+---+---+---+---+---+---+       ")
    print ("i     | %c | %c | %c | %c | %c | %c | %c | %c | %c |      " % (N[72], N[73], N[74],N[75], N[76], N[77],N[78], N[79], N[80]) )
    print ("                 ")

def minas16x16():
    print ("                 ")
    print ("        1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  ")
    print ("      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+       ")
    print ("a     | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c |      " % (M[0], M[1], M[2],M[3], M[4], M[5],M[6], M[7], M[8], M[9], M[10], M[11],M[12], M[13], M[14],M[15]) )
    print ("      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+       ")
    print ("b     | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c |      " % (M[16], M[17], M[18],M[19], M[20], M[21],M[22], M[23], M[24], M[25], M[26], M[27],M[28], M[29], M[30],M[31]) )
    print ("      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+       ")
    print ("c     | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c |      " % (M[32], M[33], M[34],M[35], M[36], M[37],M[38], M[39], M[40], M[41], M[42], M[43],M[44], M[45], M[46],M[47]) )
    print ("      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+       ")
    print ("d     | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c |      " % (M[48], M[49], M[50],M[51], M[52], M[53],M[54], M[55], M[56], M[57], M[58], M[59],M[60], M[61], M[62],M[63]) )
    print ("      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+       ")
    print ("e     | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c |      " % (M[64], M[65], M[66],M[67], M[68], M[69],M[70], M[71], M[72], M[73], M[74], M[75],M[76], M[77], M[78],M[79]) )
    print ("      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+       ")
    print ("f     | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c |      " % (M[80], M[81], M[82],M[83], M[84], M[85],M[86], M[87], M[88], M[89], M[90], M[91],M[92], M[93], M[94],M[95]) )
    print ("      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+       ")
    print ("g     | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c |      " % (M[96], M[97], M[98],M[99], M[100], M[101],M[102], M[103], M[104], M[105], M[106], M[107],M[108], M[109], M[110],M[111]) )
    print ("      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+       ")
    print ("h     | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c |      " % (M[112], M[113], M[114],M[115], M[116], M[117],M[118], M[119], M[120], M[121], M[122], M[123],M[124], M[125], M[126],M[127]) )
    print ("      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+       ")
    print ("i     | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c |     " % (M[128], M[129], M[130],M[131], M[132], M[133],M[134], M[135], M[136], M[137], M[138], M[139],M[140], M[141], M[142],M[143]) )
    print ("      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+       ")
    print ("j     | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c |     " % (M[144], M[145], M[146],M[147], M[148], M[149],M[150], M[151], M[152], M[153], M[154], M[155],M[156], M[157], M[158],M[159]) )
    print ("      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+       ")
    print ("k     | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c |     " % (M[160], M[161], M[162],M[163], M[164], M[165],M[166], M[167], M[168], M[169], M[170], M[171],M[172], M[173], M[174],M[175]) )
    print ("      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+       ")
    print ("l     | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c |     " % (M[176], M[177], M[178],M[179], M[180], M[181],M[182], M[183], M[184], M[185], M[186], M[187],M[188], M[189], M[190],M[191]) )
    print ("      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+       ")
    print ("m     | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c |     " % (M[192], M[193], M[194],M[195], M[196], M[197],M[198], M[199], M[200], M[201], M[202], M[203],M[204], M[205], M[206],M[207]) )
    print ("      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+       ")
    print ("n     | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c |     " % (M[208], M[209], M[210],M[211], M[212], M[213],M[214], M[215], M[216], M[217], M[218], M[219],M[220], M[221], M[222],M[223]) )
    print ("      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+       ")
    print ("o     | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c |     " % (M[224], M[225], M[226],M[227], M[228], M[229],M[230], M[231], M[232], M[233], M[234], M[235],M[236], M[237], M[238],M[239]) )
    print ("      +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+       ")
    print ("p     | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c | %c |     " % (M[240], M[241], M[242],M[243], M[244], M[245],M[246], M[247], M[248], M[249], M[250], M[251],M[252], M[253], M[254],M[255]) )
    print ("                 ")

def ganar9x9(N):
    ganador = True
    for i in range (81):
        if (N[i] == '0'):
            ganador = False
    return ganador

def ganar16x16(M):
    ganador = True
    for i in range (256):
        if (M[i] == '0'):
            ganador = False
    return ganador

class hilo_servidor(threading.Thread):
    def __init__(self,conexion,addres,sockets):
        threading.Thread.__init__(self)
        self.conexion = conexion
        self.addres = addres
        self.sockets = sockets
    def run(sc):
        print("\n Nueva conexion: ", sc.addres[0])
        for sock in sc.sockets:
            mensaje = sc.conexion.recv(15)
                
            if(mensaje == b'principiante'):
                print ("jugando con el cliente")
                sc.conexion.sendall(b"Listo para recibir y validar")
                a=0
                while (a<81):
                    k=randrange(0,81)
                    if (N[k]=="0"):
                        N[k]=="1"
                        a=a+1

                minas9x9()

                while True:
                    p = int(sc.conexion.recv(2))
                    if(N[p]=="1"):
                        k="X"
                    else:
                        k="*"
                        N[p]="-"
                        minas9x9()
                    sc.conexion.send(k.encode('UTF-8'))
                    gana=ganar9x9(N)
                    sc.conexion.send(str(gana).encode('UTF-8'))
                    if (k=="X"):
                        print ("\n BOOOOOOM!!!")
                        break
                    elif (gana==True):
                        print ("\n FELICITACIONES!!!")
                        break
                print ("\n \n FIN DEL JUEGO")

            if(mensaje == b'avanzado'):
                sc.conexion.sendall(b"Listo para recibir y validar")
                print ("jugando con el cliente")
                a=0
                while (a<256):
                    k=randrange(0,256)
                    if (M[k]=="0"):
                        M[k]=="1"
                        a=a+1

                minas16x16()

                while True:
                    p = int(sc.conexion.recv(3))
                    if(M[p]=='1'):
                        k="X"
                    else:
                        k="*"
                        M[p]="-"
                        minas16x16()
                    sc.conexion.send(k.encode('UTF-8'))
                    gana=ganar16x16(M)
                    sc.conexion.send(str(gana).encode('UTF-8'))
                    if (k=="X"):
                        print ("\n BOOOOOOM!!!")
                        break
                    elif (gana==True):
                        print ("\n FELICITACIONES!!!")
                        break
                print ("\n \n FIN DEL JUEGO")

N=['0','1','0','0','0','0','1','0','0','0','0','0','1','0','0','0','0','0','0','0','0','1','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','0','1','0','0','1','0','0','0','0','0','0','0','0','1','0',
'0','0','0','1','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0']
M=['1','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','1','0','0','0','0','0','0','1','0','0','0','0','0','0','1','0','0','0','0','1','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','1',
'0','0','0','1','0','0','0','0','0','1','0','0','0','0','0','1','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','1','0','0','0','0','0','0','1','1','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','0','1','0','0','0','0','0','1','0',
'0','1','0','0','0','0','0','0','1','0','0','1','0','0','0','0','0','0','0','1','0','0','0','0','1','0','0','0','0','0','0','0','0','0','0','0','0','0','1','1','0','0','0','0','0','0','0','0','0','0','0','1','0','0','0','0','0','0','1','0','0','0','0','0','0','0','0','0','1','1','0','0','0','0','0','0','1','0','0','0','1',
'0','0','0','0','1','1','0','0','0','0','0','1','0','0','0','0','0','1','0','0','0','0','1','0','0','0','0','0','0','0','0','0','1','1','0','0','0','0','0','1']

HOST = "192.168.0.2"  # Direccion de la interfaz de loopback estándar (localhost)
PORT = 65432  # Puerto que usa el cliente  (los puertos sin provilegios son > 1023)
buffer_size = 1024

class servidor():
    def iniciar():
        clientes_sockets = []
        hilos = []
        TCPServerSocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        TCPServerSocket.bind((HOST, PORT))
        print("El servidor TCP está disponible y en espera de solicitudes")
        TCPServerSocket.listen(5)
        while True:
            sc,addres = TCPServerSocket.accept()
            hilo = hilo_servidor(sc, addres,clientes_sockets)
            hilo.start()
            hilos.append(hilo)
            clientes_sockets.append(sc)

servidor.iniciar()